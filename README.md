# Интеграция модуля google_client.py

Модуль предоставляет удобный интерфейс для работы с Google Sheets и Google Docs. Он используется для:

- чтения данных из таблицы;
- получения текста из Google Docs;
- скачивания медиафайлов по ссылкам;
- обновления статусов и другой информации в таблице.

## 1. Установка зависимостей

Выполните в терминале:

```bash
pip install -r requirements.txt
```

## 2. Настройка доступа к Google API

1. Создайте проект в Google Cloud Console.
2. Включите API:

- Google Sheets API
- Google Docs API

3. Создайте сервисный аккаунт:

- Перейдите в «IAM и администрирование» → «Сервисные аккаунты».
- Создайте новый аккаунт, скачайте JSON-ключ.
- Сохраните ключ в корне проекта, например creds.json (добавьте его в .gitignore!).

4. Дайте доступ сервисному аккаунту:

- Откройте Google Таблицу, с которой будете работать.
- Нажмите «Настройки доступа» и добавьте email сервисного аккаунта (из JSON) как Редактор.
- Для каждого Google Документа, из которого планируете получать текст, также откройте доступ (роль Читатель).

## 3. Подключение и использование в коде

```python
from google_client import GoogleClient

# Создаём клиент (авторизация происходит автоматически)
client = GoogleClient('creds.json')

# ID таблицы можно взять из её URL: https://docs.google.com/spreadsheets/d/1abc.../edit
SHEET_ID = 'ваш_id_таблицы'

# Чтение данных (например, колонки A-H на листе "Лист1")
rows = client.read_sheet(SHEET_ID, 'Лист1!A:H')
# rows[0] – заголовки, rows[1:] – данные

# Получение текста из документа по ссылке
doc_url = 'https://docs.google.com/document/d/...'
try:
    text = client.get_text_from_doc(doc_url)
except Exception as e:
    print('Ошибка получения текста:', e)

# Скачивание медиа по прямой ссылке
media_url = 'https://example.com/image.jpg'
file_path = client.download_media(media_url)
if file_path:
    print('Медиа сохранено в', file_path)

# Обновление статуса в ячейке H2
client.update_cell(SHEET_ID, row=2, col='H', value='Опубликовано')
```

## 4. Важные замечания

1. Не коммитьте JSON-ключ! Он должен быть в .gitignore. Используйте переменные окружения или передавайте путь через конфиг.
2. Доступ к документам: сервисному аккаунту нужно явно открыть доступ к каждому документу (роль «Читатель»), иначе get_text_from_doc вернёт ошибку 403.
3. Обработка ошибок: методы могут выбрасывать исключения (например, при проблемах с сетью или доступом). Обязательно оборачивайте вызовы в try/except и обновляйте статус в таблице.
4. Лимиты API: соблюдайте разумные паузы между запросами (например, time.sleep(1) после каждой итерации обработки строк), чтобы не превысить квоты Google.
5. Хранение ID постов: если нужно сохранять ID опубликованных постов для последующего удаления, используйте update_cell для отдельной колонки (например, I). При необходимости метод можно расширить.
